<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:x12="http://www.mulesoft.org/schema/mule/x12"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/x12 http://www.mulesoft.org/schema/mule/x12/current/mule-x12.xsd">
	<sub-flow name="orchestrator-effem-ftp-edi-990-x12-main" doc:id="b7ff4c43-3ed4-4706-88b5-8591643321ea" >
		<flow-ref doc:name="orchestrator-effem-ftp-edi-990-x12-prepare-doc" doc:id="0256f896-a330-47f5-ab34-53f400afad9b" name="orchestrator-effem-ftp-edi-990-x12-prepare-doc"/>
		<flow-ref doc:name="orchestrator-effem-ftp-edi-990-x12-write" doc:id="05ece7a8-2645-4857-9b47-dd3efbe156d1" name="orchestrator-effem-ftp-edi-990-x12-write"/>
		<flow-ref doc:name="orchestrator-effem-ftp-edi-990-x12-set-name" doc:id="f14c70c9-3d89-42d4-897d-561689ab5fe7" name="orchestrator-effem-ftp-edi-990-x12-set-name"/>
		<flow-ref doc:name="clients-ftp-write-file" doc:id="09eb2591-ce7d-40b0-8361-328243a10a0b" name="clients-ftp-write-file"/>
	</sub-flow>
	<sub-flow name="orchestrator-effem-ftp-edi-990-x12-prepare-doc" doc:id="edb41679-e211-4401-baae-3cc37aa17c3d" >
		<ee:transform doc:name="Transform Message" doc:id="a2ff77b4-d887-4eea-a186-f3cf3c2b6b40" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/java
type BigDecimal = Number {class : "java.math.BigDecimal"}
ns ns0 http://xmlns.mulesoft.com/enterpriseobjects/finance/purchaseorder/
ns ns1 http://xmlns.mulesoft.com/enterpriseobjects/core/address/
---
{
  "Errors": [
    
  ],
  "Delimiters": "*`U~",
  "TransactionSets": {
    "v004010": {
      "990": [
        {
          "Interchange": {
            "ISA09": vars.payloadBK.CISDocument.Load.LoadStartDateTime as Date,
            "ISA04": "",
            "ISA15": p('effem.edi.isa.env'), //properties env
            "ISA03": "00", //hard code
            "ISA14": "0",
            "ISA02": "", //hard code
            "ISA13": vars.payloadBK.CISDocument.Load.ShipmentLeg.ShipmentDescription default 0 as Number, // Load id
            "ISA01": "00", //hard code
            "ISA12": "00401", //hard code
            "ISA08": "LOAL", //hard code
            "ISA07": "ZZ",
            "ISA06": "TRAXION",
            "ISA05": "02", //hard code
            "ISA16": "`",
            "ISA11": "U",
            "ISA10": vars.payloadBK.CISDocument.Load.LoadStartDateTime as DateTime as String {format: "HHmmss"} as Number
          },
          "Group": {
            "GS05": vars.payloadBK.CISDocument.Load.LoadStartDateTime as DateTime as String {format: "HHmmss"} as Number,
            "GS04": vars.payloadBK.CISDocument.Load.LoadStartDateTime as Date,
            "GS07": "X",
            "GS06": vars.payloadBK.CISDocument.Load.SystemLoadID,
            "GS08": "004010",
            "GS01": "FA",
            "GS03": "LOAL",
            "GS02": "TRAXION"
          },
          "Heading": {
            "020_B1": {
              "B103":  vars.payloadBK.CISDocument.Load.ShipmentLeg.PickupArrivalDateTime as Date,
              "B104": "A",
              "B101": "",
              "B102":  vars.payloadBK.CISDocument.Load.ShipmentLeg.ShipmentNumber
            }
          },
          "SetTrailer": {
            "SE02": vars.payloadBK.CISDocument.Load.CarrierCode,
            "SE01": 6
          },
          "Id": "990",
          "SetHeader": {
            "ST01": "990",
            "ST02": vars.payloadBK.CISDocument.Load.SystemLoadID
          },
          "Name": "Response to a Load Tender"
        }
      ]
    }
  }
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
			
	</sub-flow>
	<sub-flow name="orchestrator-effem-ftp-edi-990-x12-write" doc:id="76f648e3-52fd-4e1e-8625-ff6539f404ef" >
	<x12:write doc:name="Write" doc:id="a06931d0-f2d4-4dff-bd4b-3a1d7d61b637" config-ref="X12_EDI_Config-wri"/>
	</sub-flow>
	<sub-flow name="orchestrator-effem-ftp-edi-990-x12-set-name" doc:id="65a5c364-123b-4b55-8e4b-5a769de6ec3c" >
		<ee:transform doc:name="Transform Message" doc:id="43681cee-492c-4422-b3b2-7961e7386c95" >
			<ee:message >
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="doc_name" ><![CDATA[%dw 2.0
output application/json
---
"LOAD.TRAXION.990"++ vars.payloadBK.CISDocument.Load.ShipmentLeg.ShipmentDescription ++ ".EDI"]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
	</sub-flow>
</mule>
